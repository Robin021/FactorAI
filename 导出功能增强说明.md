# 导出功能增强说明

## 问题描述

之前的导出功能只包含了部分分析内容，缺失了重要的研究团队决策和风险管理团队决策等关键信息。

## 修改内容

### 1. 前端导出增强 (frontend/src/pages/AnalysisReport/AnalysisReport.tsx)

#### 新增导出内容：

**🎯 最终交易决策**
- 最终交易决策文本 (`final_trade_decision`)
- 操作建议 (`decision.action`)
- 目标价格 (`decision.target_price`)
- 置信度 (`decision.confidence`)
- 决策理由 (`decision.reasoning`)

**🔬 研究团队决策**
- 📈 多头研究员分析 (`investment_debate_state.bull_history`)
- 📉 空头研究员分析 (`investment_debate_state.bear_history`)
- 🎯 研究经理综合决策 (`investment_debate_state.judge_decision`)

**🛡️ 风险管理团队决策**
- 🚀 激进分析师观点 (`risk_debate_state.risky_history` / `current_risky_response`)
- 🛡️ 保守分析师观点 (`risk_debate_state.safe_history` / `current_safe_response`)
- ⚖️ 中性分析师观点 (`risk_debate_state.neutral_history` / `current_neutral_response`)
- 🎯 投资组合经理最终决策 (`risk_debate_state.judge_decision`)

#### 样式优化：
- 增加了子章节样式 (`.subsection`)
- 优化了决策摘要的显示样式 (`.decision-summary`)
- 改进了打印时的分页控制
- 增强了视觉层次感

### 2. 后端导出增强 (backend/api/v1/analysis.py)

在 `download_analysis_pdf` 接口中增加了对以下内容的提取：

**研究团队决策**
- 多头研究员分析（前600字符）
- 空头研究员分析（前600字符）
- 研究经理决策（前600字符）

**风险管理团队决策**
- 激进分析师观点（前600字符）
- 保守分析师观点（前600字符）
- 中性分析师观点（前600字符）
- 投资组合经理决策（前600字符）

## 导出内容对比

### 修改前
1. 📊 投资建议
2. 📈 基本面分析
3. 📉 技术面分析
4. 💭 市场情绪分析
5. ⚠️ 风险评估

### 修改后
1. 🎯 **最终交易决策** ⭐ 新增
2. 📊 投资建议
3. 🔬 **研究团队决策** ⭐ 新增
   - 多头研究员分析
   - 空头研究员分析
   - 研究经理综合决策
4. 🛡️ **风险管理团队决策** ⭐ 新增
   - 激进分析师观点
   - 保守分析师观点
   - 中性分析师观点
   - 投资组合经理最终决策
5. 📈 基本面分析
6. 📉 市场与技术分析
7. 💭 市场情绪分析
8. ⚠️ 风险评估

## 使用方式

1. 在分析报告页面点击"导出"按钮
2. 选择"PDF 报告"
3. 系统会打开新窗口显示完整的报告内容
4. 使用浏览器的打印功能保存为PDF

## 技术细节

- 前端使用模板字符串动态构建HTML内容
- 根据数据可用性动态显示/隐藏章节
- 兼容多种数据字段名称（如 `risky_history` 和 `current_risky_response`）
- 后端PDF生成使用UTF-16BE编码支持中文
- 自动处理缺失数据，不会因为某个字段为空而报错

## 注意事项

1. 导出的PDF内容取决于分析结果中实际包含的数据
2. 如果某个章节的数据为空，该章节不会显示在导出的PDF中
3. 长文本会被适当截断以保证PDF的可读性
4. 建议使用Chrome或Edge浏览器以获得最佳的PDF导出效果

## 测试建议

1. 测试包含完整数据的分析报告导出
2. 测试部分数据缺失的分析报告导出
3. 验证中文字符在PDF中的正确显示
4. 检查各个章节的内容完整性
5. 确认打印样式的正确性
