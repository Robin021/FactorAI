# 模型切换指南

## 📋 配置文件说明

### 配置层级关系

```
.env 文件 (API密钥)
    ↓
config/settings.json (默认模型选择)
    ↓
config/models.json (模型参数)
    ↓
代码运行时读取
```

## 🎯 方法1: 前端界面切换（推荐）

### 步骤：

1. **启动服务器**
   ```bash
   python start_server.py
   ```

2. **访问配置页面**
   - 打开浏览器访问：`http://localhost:8000`
   - 登录后进入 **系统配置** 页面
   - 点击 **模型选择** 标签

3. **选择模型**
   - 从下拉列表选择提供商（如：阿里百炼、DeepSeek、OpenAI）
   - 选择具体模型（如：qwen-turbo、deepseek-chat）
   - 点击 **保存更改**

4. **立即生效**
   - 保存后，新的分析任务将使用新模型
   - 无需重启服务器

### 界面功能：

- ✅ 实时显示当前默认模型
- ✅ 只显示已启用且配置了API密钥的模型
- ✅ 显示模型详细参数（max_tokens、temperature等）
- ✅ 一键保存和重置

## 🔧 方法2: 手动修改配置文件

### 修改 `config/settings.json`

```json
{
  "default_provider": "dashscope",    // 改这里：提供商
  "default_model": "qwen-turbo",      // 改这里：模型名称
  ...
}
```

### 可选的模型组合：

#### 阿里百炼（通义千问）
```json
// 快速便宜
"default_provider": "dashscope",
"default_model": "qwen-turbo"

// 更强大
"default_provider": "dashscope",
"default_model": "qwen-plus-latest"
```

#### DeepSeek（性价比高）
```json
"default_provider": "deepseek",
"default_model": "deepseek-chat"
```

#### OpenAI
```json
"default_provider": "openai",
"default_model": "gpt-4"
```

### 重启服务器
```bash
# 停止当前服务器 (Ctrl+C)
# 重新启动
python start_server.py
```

## 🔑 配置API密钥

### 在 `.env` 文件中配置对应的API密钥：

```bash
# 阿里百炼
DASHSCOPE_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# DeepSeek
DEEPSEEK_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
DEEPSEEK_ENABLED=true

# OpenAI
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# Google Gemini
GOOGLE_API_KEY=AIzaxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

## 📊 查看当前配置

### 方法1: API接口
```bash
curl http://localhost:8000/api/v1/config/default-model
```

### 方法2: 查看日志
启动分析任务时，日志会显示：
```
📋 使用配置的模型: dashscope/qwen-turbo
```

## ⚠️ 注意事项

1. **API密钥必须配置**
   - 模型只有在 `.env` 中配置了有效的API密钥后才能使用
   - 前端界面只显示已启用的模型

2. **模型必须在 models.json 中定义**
   - 如需添加新模型，需要在 `config/models.json` 中添加配置

3. **立即生效**
   - 通过前端界面修改：立即生效，无需重启
   - 手动修改配置文件：需要重启服务器

4. **成本考虑**
   - 不同模型的价格差异很大
   - 可在 `config/pricing.json` 中查看各模型定价

## 🚀 推荐配置

### 开发测试环境
```json
"default_provider": "dashscope",
"default_model": "qwen-turbo"
```
- 速度快
- 成本低
- 中文优化好

### 生产环境
```json
"default_provider": "deepseek",
"default_model": "deepseek-chat"
```
- 性价比极高
- 性能强大
- 稳定可靠

### 高精度需求
```json
"default_provider": "openai",
"default_model": "gpt-4"
```
- 最强性能
- 成本较高
- 需要国外网络

## 🔍 故障排查

### 问题1: 前端看不到某个模型
**原因**: 模型未启用或缺少API密钥
**解决**: 
1. 检查 `.env` 文件中是否配置了对应的API密钥
2. 检查 `config/models.json` 中该模型的 `enabled` 是否为 `true`

### 问题2: 修改后没有生效
**原因**: 使用了手动修改配置文件的方式
**解决**: 重启服务器

### 问题3: API调用失败
**原因**: API密钥无效或网络问题
**解决**: 
1. 验证 `.env` 中的API密钥是否正确
2. 检查网络连接（OpenAI需要国外网络）
3. 查看服务器日志获取详细错误信息

## 📚 相关文档

- [API密钥获取指南](./API密钥获取.md)
- [模型定价说明](../config/pricing.json)
- [配置文件说明](../config/README.md)
