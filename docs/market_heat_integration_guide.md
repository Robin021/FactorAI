# å¸‚åœºçƒ­åº¦é›†æˆä½¿ç”¨æŒ‡å—

## âœ… é›†æˆå®Œæˆ

å¸‚åœºçƒ­åº¦åŠ¨æ€é£é™©æ§åˆ¶ç³»ç»Ÿå·²æˆåŠŸé›†æˆåˆ°TradingAgentsåˆ†ææµç¨‹ä¸­ï¼

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. è‡ªåŠ¨å¸‚åœºçƒ­åº¦è¯„ä¼°

æ¯æ¬¡åˆ†æå¼€å§‹æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
1. è·å–å®æ—¶å¸‚åœºæ•°æ®ï¼ˆæ¶¨åœå®¶æ•°ã€æ¢æ‰‹ç‡ã€æˆäº¤é‡ç­‰ï¼‰
2. è®¡ç®—å¸‚åœºçƒ­åº¦è¯„åˆ†ï¼ˆ0-100åˆ†ï¼‰
3. ç¡®å®šå¸‚åœºçƒ­åº¦ç­‰çº§ï¼ˆæå†·/å†·æ·¡/æ­£å¸¸/ç«çƒ­/æ²¸è…¾ï¼‰

### 2. åŠ¨æ€é£é™©è¾©è®ºè½®æ¬¡

æ ¹æ®å¸‚åœºçƒ­åº¦è‡ªåŠ¨è°ƒæ•´é£é™©è¾©è®ºè½®æ¬¡ï¼š

| å¸‚åœºçƒ­åº¦ | è¾©è®ºè½®æ¬¡ | è¯´æ˜ |
|---------|---------|------|
| â‰¥ 60åˆ† | **2è½®** | å¸‚åœºç«çƒ­ï¼Œå……åˆ†è®¨è®ºæœºä¼šä¸é£é™© |
| < 60åˆ† | **1è½®** | å¸‚åœºå†·æ·¡ï¼Œå¿«é€Ÿå†³ç­–é¿å…è¿‡åº¦åˆ†æ |

### 3. é£é™©æ§åˆ¶å‚æ•°è°ƒæ•´

ç³»ç»Ÿä¼šåœ¨æœ€ç»ˆå†³ç­–ä¸­è€ƒè™‘å¸‚åœºçƒ­åº¦ï¼Œè°ƒæ•´ï¼š
- ä»“ä½å»ºè®®ï¼ˆå¸‚åœºçƒ­æ—¶æé«˜ï¼Œå†·æ—¶é™ä½ï¼‰
- æ­¢æŸå»ºè®®ï¼ˆå¸‚åœºçƒ­æ—¶æ”¾å®½ï¼Œå†·æ—¶æ”¶ç´§ï¼‰

## ğŸ“Š å·¥ä½œæµç¨‹

```
START
  â†“
ğŸŒ¡ï¸ Market Heat Evaluator (æ–°å¢)
  â”œâ”€ è·å–å¸‚åœºæ•°æ®
  â”œâ”€ è®¡ç®—çƒ­åº¦è¯„åˆ†
  â””â”€ å­˜å…¥state
  â†“
ğŸ“Š Market Analyst
  â†“
ğŸ“± Social Analyst
  â†“
ğŸ“° News Analyst
  â†“
ğŸ’¼ Fundamentals Analyst
  â†“
ğŸ‚ Bull Researcher âŸ· ğŸ» Bear Researcher
  â†“
ğŸ‘¨â€âš–ï¸ Research Manager
  â†“
ğŸ’¼ Trader
  â†“
ğŸ² Risky Analyst âŸ· ğŸ›¡ï¸ Safe Analyst âŸ· âš–ï¸ Neutral Analyst
  â”‚  (æ ¹æ®å¸‚åœºçƒ­åº¦åŠ¨æ€è°ƒæ•´è½®æ¬¡)
  â†“
ğŸ‘¨â€âš–ï¸ Risk Judge
  â”‚  (è€ƒè™‘å¸‚åœºçƒ­åº¦ç»™å‡ºæœ€ç»ˆå»ºè®®)
  â†“
END
```

## ğŸ”§ é…ç½®é€‰é¡¹

### å¯ç”¨åŠ¨æ€é£é™©è¾©è®ºï¼ˆé»˜è®¤ï¼‰

```python
from tradingagents.graph.conditional_logic import ConditionalLogic

logic = ConditionalLogic(
    max_debate_rounds=1,
    max_risk_discuss_rounds=1,
    enable_dynamic_risk_rounds=True  # å¯ç”¨åŠ¨æ€è°ƒæ•´
)
```

### ç¦ç”¨åŠ¨æ€é£é™©è¾©è®º

å¦‚æœä½ æƒ³ä½¿ç”¨å›ºå®šçš„é£é™©è¾©è®ºè½®æ¬¡ï¼š

```python
logic = ConditionalLogic(
    max_debate_rounds=1,
    max_risk_discuss_rounds=2,  # å›ºå®š2è½®
    enable_dynamic_risk_rounds=False  # ç¦ç”¨åŠ¨æ€è°ƒæ•´
)
```

## ğŸ“ Stateç»“æ„å˜åŒ–

æ–°å¢äº†ä»¥ä¸‹å­—æ®µåˆ°AgentStateï¼š

```python
class AgentState(MessagesState):
    # ... åŸæœ‰å­—æ®µ ...
    
    # æ–°å¢ï¼šå¸‚åœºçƒ­åº¦ç›¸å…³å­—æ®µ
    market_heat_score: float          # å¸‚åœºçƒ­åº¦è¯„åˆ† (0-100)
    market_heat_level: str            # å¸‚åœºçƒ­åº¦ç­‰çº§ (æå†·/å†·æ·¡/æ­£å¸¸/ç«çƒ­/æ²¸è…¾)
    market_heat_data: dict            # å¸‚åœºçƒ­åº¦è¯¦ç»†æ•°æ®
```

## ğŸ® ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šè¿è¡Œå®Œæ•´åˆ†æ

```python
from tradingagents import TradingAgents

# åˆ›å»ºåˆ†æå®ä¾‹
agent = TradingAgents(
    config={
        'enable_dynamic_risk_rounds': True  # å¯ç”¨åŠ¨æ€é£é™©è¾©è®º
    }
)

# è¿è¡Œåˆ†æï¼ˆä¼šè‡ªåŠ¨è¯„ä¼°å¸‚åœºçƒ­åº¦ï¼‰
result = agent.analyze(
    stock_code="600519",
    trade_date="2025-10-29"
)

# æŸ¥çœ‹å¸‚åœºçƒ­åº¦ä¿¡æ¯
print(f"å¸‚åœºçƒ­åº¦: {result['market_heat_score']:.1f}")
print(f"çƒ­åº¦ç­‰çº§: {result['market_heat_level']}")
print(f"é£é™©è¾©è®ºè½®æ¬¡: {result['market_heat_data']['risk_adjustment']['risk_rounds']}")
```

### ç¤ºä¾‹2ï¼šæŸ¥çœ‹å¸‚åœºçƒ­åº¦è¯¦æƒ…

```python
from tradingagents.agents.utils.market_heat_node import get_market_heat_summary

# ä»åˆ†æç»“æœä¸­è·å–å¸‚åœºçƒ­åº¦æ‘˜è¦
summary = get_market_heat_summary(result)
print(summary)
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
## ğŸŒ¡ï¸ å¸‚åœºçƒ­åº¦åˆ†æ

### çƒ­åº¦è¯„åˆ†
- **è¯„åˆ†**: 27.2 / 100
- **ç­‰çº§**: å†·æ·¡

### å¸‚åœºæ•°æ®
- æ¶¨åœå®¶æ•°: 101å®¶ (1.75%)
- ä¸Šæ¶¨å®¶æ•°: 2672å®¶ (46.35%)
- ä¸‹è·Œå®¶æ•°: 2621å®¶
- å¹³å‡æ¢æ‰‹ç‡: 3.67%
- æˆäº¤é‡æ”¾å¤§: 1.00å€
- å¸‚åœºæ³¢åŠ¨ç‡: 3.06%

### é£é™©æ§åˆ¶è°ƒæ•´
- ä»“ä½å€æ•°: 0.70x
- æ­¢æŸæ”¶ç´§ç³»æ•°: 1.20x
- é£é™©è¾©è®ºè½®æ¬¡: 1è½®

### ç­–ç•¥å»ºè®®
â„ï¸ å¸‚åœºäº¤æŠ•æ¸…æ·¡ï¼ˆçƒ­åº¦ï¼š27.2ï¼‰
å»ºè®®ï¼š
- é™ä½ä»“ä½è‡³70%å·¦å³
- é€‚å½“æ”¶ç´§æ­¢æŸ
- è°¨æ…æ“ä½œï¼Œå…³æ³¨å¸‚åœºæƒ…ç»ªå˜åŒ–
- é£é™©æ§åˆ¶é‡‡ç”¨ä¿å®ˆç­–ç•¥ï¼ˆ1è½®è¾©è®ºï¼‰
```

## ğŸ§ª æµ‹è¯•éªŒè¯

è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯é›†æˆï¼š

```bash
# æµ‹è¯•åŠ¨æ€é£é™©è¾©è®ºè½®æ¬¡
python tests/test_market_heat_integration.py

# æµ‹è¯•å¸‚åœºçƒ­åº¦æ•°æ®è·å–
python tradingagents/dataflows/market_heat_data.py

# æµ‹è¯•å®Œæ•´ç¤ºä¾‹
python examples/market_heat_integration_example.py
```

## ğŸ“Š å®é™…æ•ˆæœå¯¹æ¯”

### åœºæ™¯1ï¼šç‰›å¸‚ï¼ˆå¸‚åœºçƒ­åº¦70ï¼‰

**ä¼ ç»Ÿå›ºå®šç­–ç•¥**ï¼š
- é£é™©è¾©è®ºï¼š1è½®
- å¯èƒ½é”™å¤±æœºä¼šï¼Œåˆ†æä¸å¤Ÿå……åˆ†

**åŠ¨æ€è°ƒæ•´ç­–ç•¥**ï¼š
- é£é™©è¾©è®ºï¼š**2è½®** âœ…
- å……åˆ†è®¨è®ºï¼ŒæŠŠæ¡ç‰›å¸‚æœºä¼š
- ä»“ä½å»ºè®®æé«˜30%
- æ­¢æŸæ”¾å®½20%

### åœºæ™¯2ï¼šç†Šå¸‚ï¼ˆå¸‚åœºçƒ­åº¦30ï¼‰

**ä¼ ç»Ÿå›ºå®šç­–ç•¥**ï¼š
- é£é™©è¾©è®ºï¼š1è½®
- å¿«é€Ÿå†³ç­–

**åŠ¨æ€è°ƒæ•´ç­–ç•¥**ï¼š
- é£é™©è¾©è®ºï¼š**1è½®** âœ…
- å¿«é€Ÿå†³ç­–ï¼Œé¿å…è¿‡åº¦åˆ†æ
- ä»“ä½å»ºè®®é™ä½30%
- æ­¢æŸæ”¶ç´§20%

## ğŸ” æ—¥å¿—è¾“å‡º

å¯ç”¨åï¼Œä½ ä¼šåœ¨æ—¥å¿—ä¸­çœ‹åˆ°ï¼š

```
ğŸ”§ ConditionalLogicåˆå§‹åŒ–: æŠ•èµ„è¾©è®º=1è½®, é£é™©è¾©è®ºåŸºç¡€=1è½®, åŠ¨æ€è°ƒæ•´=å¯ç”¨
ğŸŒ¡ï¸ å¸‚åœºçƒ­åº¦è¯„ä¼°ï¼šå¼€å§‹è·å–å¸‚åœºæ•°æ®
âœ… å¸‚åœºæ•°æ®è·å–æˆåŠŸ: æ¶¨åœ=101å®¶, ä¸Šæ¶¨=2672å®¶, æ¢æ‰‹ç‡=3.67%
âœ… å¸‚åœºçƒ­åº¦è¯„ä¼°å®Œæˆ: è¯„åˆ†=27.2, ç­‰çº§=å†·æ·¡, é£é™©è¾©è®ºè½®æ¬¡=1è½®
ğŸŒ¡ï¸ å¸‚åœºçƒ­åº¦27.2ï¼ˆå†·æ·¡ï¼‰ï¼Œé£é™©è¾©è®ºè½®æ¬¡: 1è½®ï¼ˆå¿«é€Ÿå†³ç­–ï¼‰
âœ… é£é™©è¾©è®ºå®Œæˆ: 3æ¬¡å‘è¨€ (ç›®æ ‡: 3æ¬¡, 1è½®)
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ•°æ®ä¾èµ–

å¸‚åœºçƒ­åº¦è¯„ä¼°ä¾èµ–AKShareå®æ—¶æ•°æ®ï¼š
- éœ€è¦ç½‘ç»œè¿æ¥
- äº¤æ˜“æ—¶é—´å¤–å¯èƒ½æ•°æ®ä¸å®Œæ•´
- å¦‚æœè·å–å¤±è´¥ï¼Œä¼šä½¿ç”¨é»˜è®¤å€¼ï¼ˆæ­£å¸¸å¸‚åœºï¼Œ1è½®è¾©è®ºï¼‰

### 2. æ€§èƒ½å½±å“

- å¸‚åœºçƒ­åº¦è¯„ä¼°å¢åŠ çº¦2-3ç§’çš„åˆå§‹åŒ–æ—¶é—´
- å¯¹æ•´ä½“åˆ†ææµç¨‹å½±å“å¾ˆå°
- å¯ä»¥é€šè¿‡ç¦ç”¨åŠ¨æ€è°ƒæ•´æ¥è·³è¿‡è¯„ä¼°

### 3. å…¼å®¹æ€§

- å®Œå…¨å‘åå…¼å®¹
- ä¸å½±å“ç°æœ‰åˆ†ææµç¨‹
- å¯ä»¥éšæ—¶å¯ç”¨/ç¦ç”¨

## ğŸš€ é«˜çº§ç”¨æ³•

### è‡ªå®šä¹‰å¸‚åœºçƒ­åº¦é˜ˆå€¼

å¦‚æœä½ æƒ³è°ƒæ•´çƒ­åº¦é˜ˆå€¼ï¼ˆé»˜è®¤60åˆ†ï¼‰ï¼š

```python
# ä¿®æ”¹ conditional_logic.py ä¸­çš„é˜ˆå€¼
def should_continue_risk_analysis(self, state: AgentState) -> str:
    heat_score = state.get("market_heat_score", 50.0)
    
    # è‡ªå®šä¹‰é˜ˆå€¼ï¼š70åˆ†ä»¥ä¸Šæ‰ç”¨2è½®
    if heat_score >= 70:  # åŸæ¥æ˜¯60
        max_rounds = 2
    else:
        max_rounds = 1
```

### è‡ªå®šä¹‰çƒ­åº¦æƒé‡

å¦‚æœä½ æƒ³è°ƒæ•´çƒ­åº¦è®¡ç®—çš„æƒé‡ï¼š

```python
from tradingagents.agents.utils.market_heat_calculator import MarketHeatCalculator

# è‡ªå®šä¹‰æƒé‡
custom_weights = {
    'volume_ratio': 0.30,      # æé«˜æˆäº¤é‡æƒé‡
    'limit_up_ratio': 0.25,    # æé«˜æ¶¨åœæƒé‡
    'turnover_rate': 0.15,
    'market_breadth': 0.15,
    'volatility': 0.10,
    'money_flow': 0.05
}

# ä½¿ç”¨è‡ªå®šä¹‰æƒé‡è®¡ç®—
heat_result = MarketHeatCalculator.calculate_market_heat(
    volume_ratio=2.0,
    limit_up_ratio=0.05,
    # ... å…¶ä»–å‚æ•°
    weights=custom_weights
)
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å¸‚åœºçƒ­åº¦è®¡ç®—å™¨](../tradingagents/agents/utils/market_heat_calculator.py)
- [å¸‚åœºçƒ­åº¦æ•°æ®æº](../tradingagents/dataflows/market_heat_data.py)
- [å¸‚åœºçƒ­åº¦èŠ‚ç‚¹](../tradingagents/agents/utils/market_heat_node.py)
- [æ¡ä»¶é€»è¾‘](../tradingagents/graph/conditional_logic.py)
- [ä½¿ç”¨æŒ‡å—](./market_heat_guide.md)

## ğŸ‰ æ€»ç»“

å¸‚åœºçƒ­åº¦åŠ¨æ€é£é™©æ§åˆ¶ç³»ç»Ÿå·²å®Œå…¨é›†æˆï¼ç°åœ¨ä½ çš„åˆ†æç³»ç»Ÿä¼šï¼š

âœ… è‡ªåŠ¨è¯„ä¼°å¸‚åœºçƒ­åº¦
âœ… åŠ¨æ€è°ƒæ•´é£é™©è¾©è®ºè½®æ¬¡
âœ… æ ¹æ®å¸‚åœºçŠ¶æ€è°ƒæ•´é£é™©æ§åˆ¶ç­–ç•¥
âœ… åœ¨æŠ¥å‘Šä¸­åŒ…å«å¸‚åœºçƒ­åº¦ä¿¡æ¯

è¿™è§£å†³äº†"å¸‚åœºçƒ­æ—¶é£é™©æ§åˆ¶å¤±çµ"çš„é—®é¢˜ï¼Œè®©ç³»ç»Ÿæ›´æ™ºèƒ½ã€æ›´é€‚åº”ä¸åŒå¸‚åœºç¯å¢ƒï¼
