<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‰ç«¯è·³è½¬æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            width: 0%;
            transition: width 0.5s ease;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .status.running {
            background: #e3f2fd;
            color: #1976d2;
        }
        .status.completed {
            background: #e8f5e8;
            color: #2e7d32;
        }
        .btn {
            background: #1976d2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #1565c0;
        }
        .log {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 14px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª å‰ç«¯è·³è½¬é€»è¾‘æµ‹è¯•</h1>
        <p>æ¨¡æ‹Ÿåˆ†æè¿›åº¦å®Œæˆåçš„è‡ªåŠ¨è·³è½¬è¡Œä¸º</p>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        
        <div class="status running" id="status">
            ğŸ“Š åˆ†æè¿›è¡Œä¸­... 0%
        </div>
        
        <div>
            <button class="btn" onclick="startSimulation()">å¼€å§‹æ¨¡æ‹Ÿåˆ†æ</button>
            <button class="btn" onclick="resetSimulation()">é‡ç½®</button>
            <button class="btn" onclick="testRedirect()">æµ‹è¯•è·³è½¬</button>
        </div>
        
        <div class="log" id="log">
            ğŸ“ æ—¥å¿—è¾“å‡ºå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...
        </div>
    </div>

    <script>
        let currentProgress = 0;
        let simulationInterval = null;
        let analysisId = 'test-analysis-' + Date.now();
        
        function log(message) {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function updateProgress(progress, status, message) {
            const progressFill = document.getElementById('progressFill');
            const statusElement = document.getElementById('status');
            
            progressFill.style.width = progress + '%';
            statusElement.textContent = `${status === 'completed' ? 'âœ…' : 'ğŸ“Š'} ${message} ${progress}%`;
            statusElement.className = `status ${status}`;
            
            log(`è¿›åº¦æ›´æ–°: ${progress}% - ${status} - ${message}`);
            
            // æ¨¡æ‹Ÿå‰ç«¯è·³è½¬é€»è¾‘
            if (status === 'completed' && progress >= 100) {
                log('ğŸ¯ åˆ†æå®Œæˆï¼Œå‡†å¤‡è·³è½¬åˆ°æŠ¥å‘Šé¡µé¢...');
                
                setTimeout(() => {
                    const reportUrl = `/analysis/report/${analysisId}`;
                    log(`ğŸ”— è·³è½¬åˆ°: ${reportUrl}`);
                    
                    // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šæ‰§è¡Œ window.location.href = reportUrl
                    // ä¸ºäº†æµ‹è¯•ï¼Œæˆ‘ä»¬åªæ˜¯æ˜¾ç¤ºè·³è½¬ä¿¡æ¯
                    alert(`âœ… è·³è½¬æˆåŠŸï¼\nç›®æ ‡é¡µé¢: ${reportUrl}\n\nåœ¨å®é™…åº”ç”¨ä¸­ï¼Œç”¨æˆ·å°†çœ‹åˆ°å®Œæ•´çš„åˆ†ææŠ¥å‘Šã€‚`);
                }, 3000); // 3ç§’å»¶è¿Ÿï¼Œè®©ç”¨æˆ·çœ‹åˆ°å®ŒæˆçŠ¶æ€
            }
        }
        
        function startSimulation() {
            if (simulationInterval) {
                clearInterval(simulationInterval);
            }
            
            currentProgress = 0;
            log('ğŸš€ å¼€å§‹æ¨¡æ‹Ÿåˆ†æè¿›ç¨‹...');
            log(`ğŸ“‹ åˆ†æID: ${analysisId}`);
            
            simulationInterval = setInterval(() => {
                currentProgress += Math.random() * 15; // éšæœºå¢åŠ è¿›åº¦
                
                if (currentProgress >= 100) {
                    currentProgress = 100;
                    updateProgress(currentProgress, 'completed', 'åˆ†æå®Œæˆï¼');
                    clearInterval(simulationInterval);
                    simulationInterval = null;
                } else {
                    const steps = [
                        'è‚¡ç¥¨è¯†åˆ«ä¸­...',
                        'å¸‚åœºåˆ†æä¸­...',
                        'åŸºæœ¬é¢åˆ†æä¸­...',
                        'æ–°é—»åˆ†æä¸­...',
                        'æƒ…ç»ªåˆ†æä¸­...',
                        'æŠ•èµ„è¾©è®ºä¸­...',
                        'é£é™©è¯„ä¼°ä¸­...'
                    ];
                    const stepIndex = Math.floor(currentProgress / 15);
                    const stepName = steps[stepIndex] || 'åˆ†æä¸­...';
                    
                    updateProgress(Math.floor(currentProgress), 'running', stepName);
                }
            }, 1000); // æ¯ç§’æ›´æ–°ä¸€æ¬¡
        }
        
        function resetSimulation() {
            if (simulationInterval) {
                clearInterval(simulationInterval);
                simulationInterval = null;
            }
            
            currentProgress = 0;
            analysisId = 'test-analysis-' + Date.now();
            updateProgress(0, 'running', 'å‡†å¤‡å¼€å§‹åˆ†æ...');
            
            const logElement = document.getElementById('log');
            logElement.innerHTML = 'ğŸ“ æ—¥å¿—å·²é‡ç½®...\n';
            
            log('ğŸ”„ æ¨¡æ‹Ÿå™¨å·²é‡ç½®');
        }
        
        function testRedirect() {
            const reportUrl = `/analysis/report/${analysisId}`;
            log(`ğŸ§ª æµ‹è¯•è·³è½¬åŠŸèƒ½: ${reportUrl}`);
            
            // æ¨¡æ‹Ÿè·³è½¬é€»è¾‘
            if (confirm(`ç¡®å®šè¦æµ‹è¯•è·³è½¬åˆ°æŠ¥å‘Šé¡µé¢å—ï¼Ÿ\n\nç›®æ ‡URL: ${reportUrl}`)) {
                log('âœ… ç”¨æˆ·ç¡®è®¤è·³è½¬');
                alert(`ğŸ¯ è·³è½¬æµ‹è¯•æˆåŠŸï¼\n\nåœ¨å®é™…åº”ç”¨ä¸­ï¼Œé¡µé¢å°†è·³è½¬åˆ°:\n${reportUrl}`);
            } else {
                log('âŒ ç”¨æˆ·å–æ¶ˆè·³è½¬');
            }
        }
        
        // åˆå§‹åŒ–
        log('ğŸ® å‰ç«¯è·³è½¬æµ‹è¯•å™¨å·²å°±ç»ª');
        log('ğŸ’¡ ç‚¹å‡»"å¼€å§‹æ¨¡æ‹Ÿåˆ†æ"æ¥æµ‹è¯•è‡ªåŠ¨è·³è½¬åŠŸèƒ½');
    </script>
</body>
</html>