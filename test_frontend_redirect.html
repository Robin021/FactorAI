<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>前端跳转测试</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            width: 0%;
            transition: width 0.5s ease;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .status.running {
            background: #e3f2fd;
            color: #1976d2;
        }
        .status.completed {
            background: #e8f5e8;
            color: #2e7d32;
        }
        .btn {
            background: #1976d2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #1565c0;
        }
        .log {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 14px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🧪 前端跳转逻辑测试</h1>
        <p>模拟分析进度完成后的自动跳转行为</p>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        
        <div class="status running" id="status">
            📊 分析进行中... 0%
        </div>
        
        <div>
            <button class="btn" onclick="startSimulation()">开始模拟分析</button>
            <button class="btn" onclick="resetSimulation()">重置</button>
            <button class="btn" onclick="testRedirect()">测试跳转</button>
        </div>
        
        <div class="log" id="log">
            📝 日志输出将显示在这里...
        </div>
    </div>

    <script>
        let currentProgress = 0;
        let simulationInterval = null;
        let analysisId = 'test-analysis-' + Date.now();
        
        function log(message) {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function updateProgress(progress, status, message) {
            const progressFill = document.getElementById('progressFill');
            const statusElement = document.getElementById('status');
            
            progressFill.style.width = progress + '%';
            statusElement.textContent = `${status === 'completed' ? '✅' : '📊'} ${message} ${progress}%`;
            statusElement.className = `status ${status}`;
            
            log(`进度更新: ${progress}% - ${status} - ${message}`);
            
            // 模拟前端跳转逻辑
            if (status === 'completed' && progress >= 100) {
                log('🎯 分析完成，准备跳转到报告页面...');
                
                setTimeout(() => {
                    const reportUrl = `/analysis/report/${analysisId}`;
                    log(`🔗 跳转到: ${reportUrl}`);
                    
                    // 在实际应用中，这里会执行 window.location.href = reportUrl
                    // 为了测试，我们只是显示跳转信息
                    alert(`✅ 跳转成功！\n目标页面: ${reportUrl}\n\n在实际应用中，用户将看到完整的分析报告。`);
                }, 3000); // 3秒延迟，让用户看到完成状态
            }
        }
        
        function startSimulation() {
            if (simulationInterval) {
                clearInterval(simulationInterval);
            }
            
            currentProgress = 0;
            log('🚀 开始模拟分析进程...');
            log(`📋 分析ID: ${analysisId}`);
            
            simulationInterval = setInterval(() => {
                currentProgress += Math.random() * 15; // 随机增加进度
                
                if (currentProgress >= 100) {
                    currentProgress = 100;
                    updateProgress(currentProgress, 'completed', '分析完成！');
                    clearInterval(simulationInterval);
                    simulationInterval = null;
                } else {
                    const steps = [
                        '股票识别中...',
                        '市场分析中...',
                        '基本面分析中...',
                        '新闻分析中...',
                        '情绪分析中...',
                        '投资辩论中...',
                        '风险评估中...'
                    ];
                    const stepIndex = Math.floor(currentProgress / 15);
                    const stepName = steps[stepIndex] || '分析中...';
                    
                    updateProgress(Math.floor(currentProgress), 'running', stepName);
                }
            }, 1000); // 每秒更新一次
        }
        
        function resetSimulation() {
            if (simulationInterval) {
                clearInterval(simulationInterval);
                simulationInterval = null;
            }
            
            currentProgress = 0;
            analysisId = 'test-analysis-' + Date.now();
            updateProgress(0, 'running', '准备开始分析...');
            
            const logElement = document.getElementById('log');
            logElement.innerHTML = '📝 日志已重置...\n';
            
            log('🔄 模拟器已重置');
        }
        
        function testRedirect() {
            const reportUrl = `/analysis/report/${analysisId}`;
            log(`🧪 测试跳转功能: ${reportUrl}`);
            
            // 模拟跳转逻辑
            if (confirm(`确定要测试跳转到报告页面吗？\n\n目标URL: ${reportUrl}`)) {
                log('✅ 用户确认跳转');
                alert(`🎯 跳转测试成功！\n\n在实际应用中，页面将跳转到:\n${reportUrl}`);
            } else {
                log('❌ 用户取消跳转');
            }
        }
        
        // 初始化
        log('🎮 前端跳转测试器已就绪');
        log('💡 点击"开始模拟分析"来测试自动跳转功能');
    </script>
</body>
</html>